<template>
  <div class="min-h-screen bg-gray-50">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-purple-600 text-white shadow-lg">
      <div class="container mx-auto px-4 py-6">
        <h1 class="text-3xl font-bold">ğŸ“Š D3.js é«˜åº¦å¯è¦–åŒ–ã‚µãƒ³ãƒ—ãƒ«</h1>
        <p class="text-purple-100 mt-2">ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ‡ãƒ¢</p>
      </div>
    </header>

    <!-- å…±é€šãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <CommonNavigation />

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="container mx-auto px-4 py-8">
      
      <!-- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¯è¦–åŒ–ã‚µãƒ³ãƒ—ãƒ« -->
      <section class="mb-12">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¯è¦–åŒ–</h2>
          <p class="text-gray-600 mb-6">é³¥å–çœŒå†…ã®åœ°åŸŸé–“é–¢ä¿‚ã‚„æ”¿ç­–å½±éŸ¿ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³</p>
          
          <NetworkVisualization
            :nodes="networkNodes"
            :links="networkLinks"
            :height="500"
            category-field="category"
            label-field="name"
            value-field="population"
            @node-click="onNodeClick"
            @link-click="onLinkClick"
          />
          
          <div class="mt-4 p-4 bg-blue-50 rounded-lg">
            <h4 class="font-semibold text-blue-800">æ“ä½œæ–¹æ³•:</h4>
            <ul class="text-blue-700 text-sm mt-2 space-y-1">
              <li>â€¢ ãƒãƒ¼ãƒ‰ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä½ç½®ã‚’å¤‰æ›´</li>
              <li>â€¢ Forceå¼·åº¦ã§å¼•åŠ›ã‚’èª¿æ•´</li>
              <li>â€¢ æ¥ç¶šè·é›¢ã§ãƒãƒ¼ãƒ‰é–“ã®è·é›¢ã‚’èª¿æ•´</li>
              <li>â€¢ ãƒãƒ¼ãƒ‰ã‚„ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°æƒ…å ±è¡¨ç¤º</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- æ™‚ç³»åˆ—åˆ†æã‚µãƒ³ãƒ—ãƒ« -->
      <section class="mb-12">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“ˆ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ™‚ç³»åˆ—åˆ†æ</h2>
          <p class="text-gray-600 mb-6">é³¥å–çœŒã®äººå£å‹•æ…‹ã¨å‡ºç”Ÿãƒ»æ­»äº¡æ•°ã®æ¨ç§»</p>
          
          <TimeSeriesAnalysis
            :data="timeSeriesData"
            :value-fields="['population', 'births', 'deaths']"
            :height="400"
            date-field="date"
            :show-brush="true"
            :enable-zoom="true"
            @period-selected="onPeriodSelected"
          />
          
          <div class="mt-4 p-4 bg-green-50 rounded-lg">
            <h4 class="font-semibold text-green-800">æ“ä½œæ–¹æ³•:</h4>
            <ul class="text-green-700 text-sm mt-2 space-y-1">
              <li>â€¢ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¡¨ç¤ºç³»åˆ—ã®åˆ‡ã‚Šæ›¿ãˆ</li>
              <li>â€¢ ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ </li>
              <li>â€¢ ä¸‹éƒ¨ã®ãƒ–ãƒ©ã‚·ã§æœŸé–“é¸æŠ</li>
              <li>â€¢ ã‚°ãƒ©ãƒ•ã«ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã§è©³ç´°ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- ãƒ‡ãƒ¼ã‚¿æƒ…å ± -->
      <section class="mb-8">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“‹ è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦</h3>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <h4 class="font-semibold text-gray-700 mb-2">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒ¼ã‚¿</h4>
              <ul class="text-sm text-gray-600 space-y-1">
                <li>â€¢ ãƒãƒ¼ãƒ‰: {{ networkNodes.length }}å€‹ã®åœ°åŸŸãƒ»æ©Ÿé–¢</li>
                <li>â€¢ ãƒªãƒ³ã‚¯: {{ networkLinks.length }}å€‹ã®é–¢ä¿‚æ€§</li>
                <li>â€¢ ã‚«ãƒ†ã‚´ãƒª: å¸‚ã€ç”ºæ‘ã€çœŒæ©Ÿé–¢</li>
              </ul>
            </div>
            <div>
              <h4 class="font-semibold text-gray-700 mb-2">æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿</h4>
              <ul class="text-sm text-gray-600 space-y-1">
                <li>â€¢ æœŸé–“: {{ timeSeriesData.length }}ãƒ¶æœˆåˆ†</li>
                <li>â€¢ æŒ‡æ¨™: äººå£ã€å‡ºç”Ÿæ•°ã€æ­»äº¡æ•°</li>
                <li>â€¢ æ›´æ–°: æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- é¸æŠã—ãŸãƒ‡ãƒ¼ã‚¿ã®è©³ç´°è¡¨ç¤º -->
      <section v-if="selectedData.node || selectedData.period" class="mb-8">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ” é¸æŠãƒ‡ãƒ¼ã‚¿è©³ç´°</h3>
          
          <!-- ãƒãƒ¼ãƒ‰é¸æŠæ™‚ -->
          <div v-if="selectedData.node" class="mb-4">
            <h4 class="font-semibold text-blue-600 mb-2">é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰</h4>
            <div class="bg-blue-50 p-4 rounded-lg">
              <p><strong>åå‰:</strong> {{ selectedData.node.name }}</p>
              <p><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> {{ selectedData.node.category }}</p>
              <p><strong>äººå£:</strong> {{ selectedData.node.population?.toLocaleString() }}äºº</p>
            </div>
          </div>

          <!-- æœŸé–“é¸æŠæ™‚ -->
          <div v-if="selectedData.period" class="mb-4">
            <h4 class="font-semibold text-green-600 mb-2">é¸æŠã•ã‚ŒãŸæœŸé–“</h4>
            <div class="bg-green-50 p-4 rounded-lg">
              <p><strong>é–‹å§‹:</strong> {{ formatDate(selectedData.period.start) }}</p>
              <p><strong>çµ‚äº†:</strong> {{ formatDate(selectedData.period.end) }}</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</template>

<script>
import NetworkVisualization from '@/components/d3/NetworkVisualization.vue'
import TimeSeriesAnalysis from '@/components/d3/TimeSeriesAnalysis.vue'
import CommonNavigation from '@/components/CommonNavigation.vue'

export default {
  name: 'D3Samples',
  components: {
    NetworkVisualization,
    TimeSeriesAnalysis,
    CommonNavigation
  },
  data() {
    return {
      selectedData: {
        node: null,
        period: null
      },
      networkNodes: [
        { id: 'tottori', name: 'é³¥å–å¸‚', category: 'å¸‚', population: 190000, value: 190 },
        { id: 'yonago', name: 'ç±³å­å¸‚', category: 'å¸‚', population: 150000, value: 150 },
        { id: 'kurayoshi', name: 'å€‰å‰å¸‚', category: 'å¸‚', population: 50000, value: 50 },
        { id: 'sakaiminato', name: 'å¢ƒæ¸¯å¸‚', category: 'å¸‚', population: 35000, value: 35 },
        { id: 'iwami', name: 'å²©ç¾ç”º', category: 'ç”ºæ‘', population: 11000, value: 11 },
        { id: 'chizu', name: 'æ™ºé ­ç”º', category: 'ç”ºæ‘', population: 7000, value: 7 },
        { id: 'wakasa', name: 'è‹¥æ¡œç”º', category: 'ç”ºæ‘', population: 3000, value: 3 },
        { id: 'yazu', name: 'å…«é ­ç”º', category: 'ç”ºæ‘', population: 17000, value: 17 },
        { id: 'misasa', name: 'ä¸‰æœç”º', category: 'ç”ºæ‘', population: 7000, value: 7 },
        { id: 'yurihama', name: 'æ¹¯æ¢¨æµœç”º', category: 'ç”ºæ‘', population: 17000, value: 17 },
        { id: 'kotoura', name: 'ç´æµ¦ç”º', category: 'ç”ºæ‘', population: 18000, value: 18 },
        { id: 'hokuei', name: 'åŒ—æ „ç”º', category: 'ç”ºæ‘', population: 15000, value: 15 },
        { id: 'daisen', name: 'å¤§å±±ç”º', category: 'ç”ºæ‘', population: 17000, value: 17 },
        { id: 'nanbu', name: 'å—éƒ¨ç”º', category: 'ç”ºæ‘', population: 11000, value: 11 },
        { id: 'hiezu', name: 'æ—¥å‰æ´¥æ‘', category: 'ç”ºæ‘', population: 3500, value: 4 },
        { id: 'hino', name: 'æ—¥é‡ç”º', category: 'ç”ºæ‘', population: 3500, value: 4 },
        { id: 'kofu', name: 'æ±Ÿåºœç”º', category: 'ç”ºæ‘', population: 3000, value: 3 },
        { id: 'pref', name: 'é³¥å–çœŒåº', category: 'çœŒæ©Ÿé–¢', population: null, value: 100 },
        { id: 'univ', name: 'é³¥å–å¤§å­¦', category: 'æ•™è‚²æ©Ÿé–¢', population: null, value: 80 },
        { id: 'airport', name: 'é³¥å–ç©ºæ¸¯', category: 'ã‚¤ãƒ³ãƒ•ãƒ©', population: null, value: 60 }
      ],
      networkLinks: [
        // çœŒåºã¨ã®é–¢ä¿‚
        { source: 'pref', target: 'tottori', value: 90 },
        { source: 'pref', target: 'yonago', value: 80 },
        { source: 'pref', target: 'kurayoshi', value: 70 },
        { source: 'pref', target: 'sakaiminato', value: 60 },
        
        // å¸‚ã¨ç”ºæ‘ã®é–¢ä¿‚ï¼ˆåœ°ç†çš„è¿‘æ¥ï¼‰
        { source: 'tottori', target: 'iwami', value: 40 },
        { source: 'tottori', target: 'chizu', value: 30 },
        { source: 'tottori', target: 'wakasa', value: 25 },
        { source: 'tottori', target: 'yazu', value: 45 },
        
        { source: 'kurayoshi', target: 'misasa', value: 35 },
        { source: 'kurayoshi', target: 'yurihama', value: 40 },
        { source: 'kurayoshi', target: 'kotoura', value: 35 },
        { source: 'kurayoshi', target: 'hokuei', value: 30 },
        
        { source: 'yonago', target: 'daisen', value: 45 },
        { source: 'yonago', target: 'nanbu', value: 35 },
        { source: 'yonago', target: 'hiezu', value: 50 },
        { source: 'sakaiminato', target: 'yonago', value: 80 },
        { source: 'sakaiminato', target: 'hiezu', value: 40 },
        
        { source: 'daisen', target: 'hino', value: 20 },
        { source: 'nanbu', target: 'hino', value: 25 },
        { source: 'hino', target: 'kofu', value: 30 },
        
        // å¤§å­¦ã¨ã®é–¢ä¿‚
        { source: 'univ', target: 'tottori', value: 70 },
        { source: 'univ', target: 'yonago', value: 50 },
        { source: 'univ', target: 'kurayoshi', value: 30 },
        
        // ç©ºæ¸¯ã¨ã®é–¢ä¿‚
        { source: 'airport', target: 'tottori', value: 60 },
        { source: 'airport', target: 'yonago', value: 40 },
        
        // å¸‚åŒå£«ã®é–¢ä¿‚
        { source: 'tottori', target: 'kurayoshi', value: 50 },
        { source: 'kurayoshi', target: 'yonago', value: 45 },
        { source: 'yonago', target: 'tottori', value: 40 }
      ],
      timeSeriesData: []
    }
  },
  mounted() {
    this.generateTimeSeriesData()
  },
  methods: {
    generateTimeSeriesData() {
      const startDate = new Date('2020-01-01')
      const months = 48 // 4å¹´é–“
      const data = []
      
      let basePopulation = 570000
      
      for (let i = 0; i < months; i++) {
        const date = new Date(startDate)
        date.setMonth(date.getMonth() + i)
        
        // å­£ç¯€å¤‰å‹•ã‚’å«ã‚€äººå£æ¨ç§»ï¼ˆæ¸›å°‘å‚¾å‘ï¼‰
        const seasonality = Math.sin((i / 12) * 2 * Math.PI) * 500
        const trend = -i * 50 // æœˆ50äººãšã¤æ¸›å°‘
        const noise = (Math.random() - 0.5) * 200
        const population = Math.round(basePopulation + trend + seasonality + noise)
        
        // å‡ºç”Ÿæ•°ï¼ˆæ˜¥ã«å¤šã„å‚¾å‘ï¼‰
        const birthSeasonality = Math.sin(((i + 3) / 12) * 2 * Math.PI) * 200 + 400
        const birthNoise = (Math.random() - 0.5) * 100
        const births = Math.round(Math.max(0, birthSeasonality + birthNoise))
        
        // æ­»äº¡æ•°ï¼ˆå†¬ã«å¤šã„å‚¾å‘ï¼‰
        const deathSeasonality = Math.sin(((i + 9) / 12) * 2 * Math.PI) * 300 + 500
        const deathNoise = (Math.random() - 0.5) * 150
        const deaths = Math.round(Math.max(0, deathSeasonality + deathNoise))
        
        data.push({
          date: date.toISOString().split('T')[0],
          population,
          births,
          deaths
        })
      }
      
      this.timeSeriesData = data
    },

    onNodeClick(node, event) {
      this.selectedData.node = node
      console.log('Node clicked:', node)
    },

    onLinkClick(link, event) {
      console.log('Link clicked:', link)
    },

    onPeriodSelected(period) {
      this.selectedData.period = period
      console.log('Period selected:', period)
    },

    formatDate(date) {
      if (!date) return ''
      return new Intl.DateTimeFormat('ja-JP').format(new Date(date))
    }
  }
}
</script>

<style scoped>
/* è¿½åŠ ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒã‚ã‚Œã°è¨˜è¿° */
</style>